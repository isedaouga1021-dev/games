<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mini Pinball</title>
<style>
  body { margin:0; background:#111; display:flex; justify-content:center; }
  canvas { background:#222; margin-top:20px; }
</style>
</head>
<body>
<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let ball = { x:200, y:100, vx:3, vy:3, r:8 };
let leftFlipper = { x:120, y:520, w:80, h:10, angle:0 };
let rightFlipper = { x:200, y:520, w:80, h:10, angle:0 };

let leftPressed = false;
let rightPressed = false;

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") leftPressed=true;
  if(e.key==="ArrowRight") rightPressed=true;
});
document.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft") leftPressed=false;
  if(e.key==="ArrowRight") rightPressed=false;
});

function drawFlipper(f, isLeft){
  ctx.save();
  ctx.translate(f.x + f.w/2, f.y + f.h/2);
  ctx.rotate(f.angle);
  ctx.fillStyle = "white";
  ctx.fillRect(-f.w/2, -f.h/2, f.w, f.h);
  ctx.restore();
}

function update(){
  ball.x += ball.vx;
  ball.y += ball.vy;
  ball.vy += 0.15; // 重力

  // 壁反射
  if(ball.x < ball.r || ball.x > canvas.width-ball.r) ball.vx *= -1;
  if(ball.y < ball.r) ball.vy *= -1;

  // フリッパー角度
  leftFlipper.angle = leftPressed ? -0.5 : 0.2;
  rightFlipper.angle = rightPressed ? 0.5 : -0.2;

  // 簡易当たり判定
  if(ball.y > 500 && ball.y < 540){
    if(ball.x > 110 && ball.x < 200 && leftPressed) ball.vy = -8;
    if(ball.x > 200 && ball.x < 290 && rightPressed) ball.vy = -8;
  }

  // 落下でゲームオーバー
  if(ball.y > canvas.height){
    alert("ゲームオーバー！");
    document.location.reload();
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ボール
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
  ctx.fillStyle="orange";
  ctx.fill();

  drawFlipper(leftFlipper, true);
  drawFlipper(rightFlipper, false);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
